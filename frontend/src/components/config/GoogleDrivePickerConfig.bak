// src/config/GoogleDrivePickerConfig.js
// Centralized configuration for Google Drive Picker integration

export const PICKER_CONFIG = {
  // API Configuration
  api: {
    tokenEndpoint: 'http://localhost:8080/api/cloud/picker-token',
    provider: 'google_drive',
    retryAttempts: 3,
    retryDelay: 1000, // milliseconds
  },

  // Picker View Configuration
  views: {
    FOLDERS_ONLY: 'folders',
    FILES_AND_FOLDERS: 'all',
    RECENT: 'recent',
    SHARED: 'shared',
    STARRED: 'starred'
  },

  // Default Picker Settings
  picker: {
    title: 'Select Camera Folders from Google Drive',
    size: {
      width: 800,
      height: 600
    },
    defaultView: 'folders',
    multiSelect: true,
    navigation: {
      hidden: true,
      folderSelect: true
    }
  },

  // Feature Flags
  features: {
    MULTISELECT: 'multiselect',
    SEARCH: 'search',
    NAV_HIDDEN: 'nav_hidden',
    SIMPLE_UPLOAD: 'simple_upload',
    FOLDER_SELECT: 'folder_select'
  },

  // UI Text and Labels
  ui: {
    buttons: {
      browse: 'Browse Google Drive Folders',
      loading: 'Opening Picker...',
      retry: 'Try Again',
      refresh: 'Refresh Page',
      clear: 'Clear Selection'
    },
    status: {
      apiReady: 'Picker API Ready',
      apiLoading: 'Loading Picker API...',
      connected: 'Google Drive Connected',
      authenticating: 'Authenticating...',
      tokenExpired: 'Token Expired'
    },
    labels: {
      selectedFolders: 'Selected Folders',
      errorTitle: 'Error',
      helpTitle: 'How to use Google Drive Picker:',
      debugTitle: 'Debug Info'
    }
  },

  // Error Messages
  errors: {
    // Authentication Errors
    notAuthenticated: 'Please authenticate with Google Drive first',
    tokenFailed: 'Failed to get access token',
    tokenExpired: 'Access token has expired. Please re-authenticate.',
    
    // API Errors
    apiNotLoaded: 'Google Picker API is still loading. Please try again in a moment.',
    apiNotAvailable: 'Google Picker API not available',
    apiLoadFailed: 'Failed to load Google Picker API. Please refresh the page.',
    
    // Picker Errors
    pickerCreateFailed: 'Failed to create picker',
    pickerOpenFailed: 'Failed to open picker',
    selectionProcessFailed: 'Failed to process selection',
    
    // Network Errors
    networkError: 'Network error occurred. Please check your connection.',
    serverError: 'Server error occurred. Please try again later.',
    rateLimitExceeded: 'Too many requests. Please wait a moment and try again.',
    
    // Generic
    unknownError: 'An unexpected error occurred'
  },

  // Help Text
  help: {
    instructions: [
      'Click "Browse Google Drive Folders" to open the picker',
      'Select folders that contain your camera videos',
      'Use Ctrl/Cmd+Click to select multiple folders',
      'Selected folders will be synced to VTrack for processing',
      'You can change selection anytime by opening the picker again'
    ],
    tips: [
      'Organize your videos in separate folders for each camera',
      'Folder names should be descriptive (e.g., "Front_Door_Camera")',
      'Large folders may take longer to sync initially',
      'Only video files will be processed from selected folders'
    ]
  },

  // Styling Classes (Tailwind CSS)
  styles: {
    button: {
      primary: 'px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105',
      disabled: 'px-6 py-3 bg-gray-400 text-gray-600 cursor-not-allowed rounded-lg font-medium',
      loading: 'px-6 py-3 bg-blue-600 text-white rounded-lg font-medium cursor-wait'
    },
    status: {
      ready: 'inline-block w-2 h-2 rounded-full bg-green-500 mr-2',
      loading: 'inline-block w-2 h-2 rounded-full bg-yellow-500 mr-2',
      error: 'inline-block w-2 h-2 rounded-full bg-red-500 mr-2'
    },
    containers: {
      main: 'google-drive-picker-integration',
      error: 'error-display mb-4 p-4 bg-red-100 border border-red-400 rounded-lg',
      success: 'selected-folders mb-4 p-4 bg-green-100 border border-green-400 rounded-lg',
      help: 'help-text p-4 bg-blue-50 border border-blue-200 rounded-lg',
      folder: 'flex items-center gap-3 p-2 bg-white rounded border'
    }
  },

  // File Type Filters
  fileTypes: {
    folders: 'application/vnd.google-apps.folder',
    videos: [
      'video/mp4',
      'video/avi',
      'video/mov',
      'video/mkv',
      'video/wmv',
      'video/flv',
      'video/webm'
    ]
  },

  // Performance Settings
  performance: {
    apiLoadTimeout: 10000, // 10 seconds
    pickerTimeout: 30000,  // 30 seconds
    tokenRefreshInterval: 3300000, // 55 minutes (before 1 hour expiry)
    maxFoldersDisplay: 50,
    debounceDelay: 300 // milliseconds
  },

  // Development Settings
  development: {
    enableDebug: process.env.NODE_ENV === 'development',
    enableConsoleLogging: true,
    mockMode: false,
    debugLevel: 'info' // 'error', 'warn', 'info', 'debug'
  }
};

// Picker Builder Helper Functions
export const PICKER_BUILDERS = {
  /**
   * Create standard folders-only picker configuration
   */
  createFoldersOnlyBuilder: (token, callback, options = {}) => {
    const config = {
      ...PICKER_CONFIG.picker,
      ...options
    };

    return new window.google.picker.PickerBuilder()
      .addView(window.google.picker.ViewId.FOLDERS)
      .setOAuthToken(token)
      .setCallback(callback)
      .setTitle(config.title)
      .setSize(config.size.width, config.size.height);
  },

  /**
   * Add features to picker builder
   */
  addFeatures: (builder, features = []) => {
    const featureMap = {
      [PICKER_CONFIG.features.MULTISELECT]: window.google.picker.Feature.MULTISELECT_ENABLED,
      [PICKER_CONFIG.features.NAV_HIDDEN]: window.google.picker.Feature.NAV_HIDDEN,
      [PICKER_CONFIG.features.SIMPLE_UPLOAD]: window.google.picker.Feature.SIMPLE_UPLOAD_ENABLED
    };

    features.forEach(feature => {
      if (featureMap[feature]) {
        builder.enableFeature(featureMap[feature]);
      }
    });

    return builder;
  },

  /**
   * Create complete picker with default VTrack settings
   */
  createVTrackPicker: (token, callback, options = {}) => {
    const builder = PICKER_BUILDERS.createFoldersOnlyBuilder(token, callback, options);
    
    // Add default features
    const features = [
      PICKER_CONFIG.features.MULTISELECT,
      PICKER_CONFIG.features.NAV_HIDDEN
    ];
    
    return PICKER_BUILDERS.addFeatures(builder, features).build();
  }
};

// Utility Functions
export const PICKER_UTILS = {
  /**
   * Format folder data for consistent structure
   */
  formatFolderData: (docs) => {
    return docs.map(doc => ({
      id: doc.id,
      name: doc.name,
      url: doc.url || '',
      type: 'folder',
      mimeType: doc.mimeType,
      lastEditedUtc: doc.lastEditedUtc,
      iconUrl: doc.iconUrl || '',
      description: doc.description || '',
      sizeBytes: doc.sizeBytes || 0,
      selected: true,
      source: 'google_drive'
    }));
  },

  /**
   * Validate folder selection
   */
  validateSelection: (folders) => {
    if (!Array.isArray(folders)) {
      return { valid: false, error: 'Invalid folder selection format' };
    }

    if (folders.length === 0) {
      return { valid: false, error: 'No folders selected' };
    }

    if (folders.length > PICKER_CONFIG.performance.maxFoldersDisplay) {
      return { 
        valid: false, 
        error: `Too many folders selected. Maximum ${PICKER_CONFIG.performance.maxFoldersDisplay} allowed.` 
      };
    }

    return { valid: true, error: null };
  },

  /**
   * Get error message by type
   */
  getErrorMessage: (errorType, customMessage = '') => {
    return PICKER_CONFIG.errors[errorType] || customMessage || PICKER_CONFIG.errors.unknownError;
  },

  /**
   * Check if API is ready
   */
  isApiReady: () => {
    return !!(window.gapi && window.google && window.google.picker);
  },

  /**
   * Generate unique picker ID
   */
  generatePickerId: () => {
    return `picker_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  }
};

// Export default configuration
export default PICKER_CONFIG;